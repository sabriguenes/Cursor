---
description: Test-first development and comprehensive test coverage
globs: ["**/*.test.*", "**/*.spec.*", "**/test_*", "**/*_test.*"]
alwaysApply: false
---

# Testing Standards

You are a QA engineer focused on writing reliable, maintainable tests.

## Testing Philosophy

- Tests are documentation
- Test behavior, not implementation
- One assertion concept per test
- Tests should be fast and independent

## Test Structure (AAA Pattern)

```
Arrange  → Set up the test data and conditions
Act      → Execute the code under test
Assert   → Verify the expected outcome
```

## Naming Convention

```
test_[unit]_[scenario]_[expected_result]

Examples:
- test_calculateTotal_withEmptyCart_returnsZero
- test_userLogin_withInvalidPassword_throwsAuthError
- it('should return zero when cart is empty')
```

## Test Types

### Unit Tests
- Test single functions/methods in isolation
- Mock external dependencies
- Fast execution (< 100ms each)

### Integration Tests
- Test component interactions
- Use real dependencies when practical
- Test API contracts

### E2E Tests
- Test critical user flows
- Minimal, focused scenarios
- Run in CI/CD

## Coverage Guidelines

| Priority | What to Test |
|----------|-------------|
| High | Business logic, calculations, validations |
| Medium | API endpoints, data transformations |
| Low | Simple getters, configuration |
| Skip | Framework code, third-party libraries |

## Test Patterns

### Happy Path First
```javascript
it('should successfully create user with valid data', () => {
  // Test the expected, normal flow first
});
```

### Edge Cases
```javascript
it('should handle empty input gracefully', () => {});
it('should reject input exceeding max length', () => {});
it('should handle concurrent requests', () => {});
```

### Error Scenarios
```javascript
it('should throw ValidationError for invalid email', () => {});
it('should return 404 when resource not found', () => {});
```

## Mocking Best Practices

- Mock at the boundary (APIs, databases, file system)
- Don't mock what you don't own excessively
- Use factories for test data
- Reset mocks between tests

## Anti-Patterns to Avoid

```
❌ Testing implementation details
❌ Tests that depend on other tests
❌ Flaky tests (timing, order-dependent)
❌ Testing private methods directly
❌ Excessive mocking
❌ No assertions ("it runs without error")
```

## When Writing Tests

1. Write the test first (TDD) or immediately after
2. Run tests frequently during development
3. Fix failing tests before adding new code
4. Refactor tests like production code
